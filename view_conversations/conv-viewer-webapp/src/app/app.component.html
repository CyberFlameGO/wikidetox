<!--The content below is only a placeholder and can be replaced.-->
<div *ngIf="!embed" style="text-align:center">
  <h3>
    WikiDetox Conversation Viewer
  </h3>
</div>

<div *ngIf="!embed">
  <form [formGroup]="browseForm" (submit)="submitBrowse()">

  <button mat-button type="button"
    [matMenuTriggerFor]="menu"><i class="material-icons">menu</i>Browse by
  </button>
  <mat-menu #menu="matMenu">
    <mat-radio-group class="browseby-radio-group"
        (change)="updateLocationHash()"
        formControlName="browseBy">
      <mat-radio-button class="searchby-radio-button" *ngFor="let s of browseBys"
        [value]="s">{{s}}</mat-radio-button>
    </mat-radio-group>
  </mat-menu>
  Score in the range of

  <mat-form-field class="browse-text">
    <input matInput type="text" placeholder="Minimum value 0"
          formControlName="browseLower">
  </mat-form-field>

  to

  <mat-form-field class="browse-text">
    <input matInput type="text" placeholder="Maximum value 1"
          formControlName="browseUpper">
  </mat-form-field>


  <button mat-raised-button
    [disabled]="!browseForm.valid || inFlightBrowseRequest !== undefined"
    type="submit" color="primary">Browse</button>
  </form>

  <mat-progress-bar *ngIf="inFlightBrowseRequest" mode="query"></mat-progress-bar>
</div>


<div *ngIf="!embed">
  <form [formGroup]="searchForm" (submit)="submitSearch()">


  <button mat-button type="button"
    [matMenuTriggerFor]="menu"><i class="material-icons">menu</i>Search by
  </button>
  <mat-menu #menu="matMenu">
    <mat-radio-group class="searchby-radio-group"
        (change)="updateLocationHash()"
        formControlName="searchBy">
      <mat-radio-button class="searchby-radio-button" *ngFor="let s of searchBys"
        [value]="s">{{s}}</mat-radio-button>
    </mat-radio-group>
  </mat-menu>

  <mat-form-field class="search-text">
    <input matInput type="text" placeholder="{{searchForm.value.searchBy}}"
          formControlName="searchFor">
  </mat-form-field>

  <button mat-raised-button
    [disabled]="!searchForm.valid || inFlightRequest !== undefined"
    type="submit" color="primary">Search</button>
  </form>

  <mat-progress-bar *ngIf="inFlightRequest" mode="query"></mat-progress-bar>
</div>

<div *ngIf="errorMessage" class="errorMessage">{{errorMessage}}</div>

<div class="conversation" *ngIf="rootComment">
  <div *ngIf="showPageContext">
    <div>In page: <b>{{rootComment.page_title}}</b></div>
    <div class="convid">
        <span class="convid-text">(conversation id: {{rootComment.id}})</span>
    </div>
  </div>

  <app-conversation *ngIf="rootComment" [rootComment]="rootComment"></app-conversation>
</div>

<div class="comments" *ngIf="answerComments">
  <button mat-raised-button
    [disabled]="inFlightRequest !== undefined || scoreUpper === undefined || scoreCategory === undefined"
    class = "moreToxicButton"
    (click)="browseByScore(scoreCategory, 1, scoreUpper, 'ASC')" color="primary">More Toxic</button>

  <button mat-raised-button
    [disabled]="inFlightRequest !== undefined || scoreLower === undefined || scoreCategory === undefined"
    class = "lessToxicButton"
    (click)="browseByScore(scoreCategory, scoreLower, 0, 'DESC')" color="primary">Less Toxic</button>


  <div *ngFor="let comment of answerComments">

    <button class="collapsible-action" (click)="comment.isCollapsed = !comment.isCollapsed; submitCommentSearch(comment)">
      <!-- {{submitParentSearch(comment.id)}} -->
     <table class="action">
       <tr>
         <td class="whenandwho">
           <div class="author" *ngIf="comment.user_text">{{comment.user_text}}</div>
           <div class="anonAuthor" *ngIf="!comment.user_text">Anonymous</div>
           <br />
           <div class="timestamp">{{comment.timestamp}}</div>
           <!-- TODO(yiqingh): add hyper link to show the previous comments -->
           <div class="modification" *ngIf="comment.type == 'MODIFICATION'">Modification from Other Comments</div>
           <div class="restoration" *ngIf="comment.type == 'RESTORATION'">Restored Comment</div>
         </td>
         <td class="content">{{comment.cleaned_content}}</td>
       </tr>
     </table>
     <div class="score" *ngIf="comment.displayScore"> {{comment.displayScore}} </div>
    </button>

    <div id="collapseComment" *ngIf="comment.isCollapsed">
      <div *ngIf="errorMessage" class="errorMessage">{{errorMessage}}</div>
      <div class="collapsedConversation" *ngIf="comment.rootComment">
        <div *ngIf="showPageContext">
          <div>In page: <a href="https://en.wikipedia.org/w/index.php?oldid={{comment.rev_id}}"><b>{{comment.rootComment.page_title}}</b></a> </div>
          <div class="convid">
            <span class="convid-text">(conversation id: {{comment.rootComment.id}})</span>
          </div>
        </div>

        <app-conversation *ngIf="comment.rootComment" [rootComment]="comment.rootComment"></app-conversation>
      </div>
    </div>



  </div>
</div>


<div *ngIf="!embed" id="debug-pre-output">{{searchResult}}</div>
